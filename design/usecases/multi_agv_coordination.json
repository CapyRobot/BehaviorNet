{
  "actors": [
    {
      "id": "user::AGV",
      "required_init_params": {
        "id": { "type": "str" },
        "Addr": { "type": "str" }
      },
      "optional_init_params": {
        "home_zone": { "type": "str" }
      }
    },
    {
      "id": "user::Zone",
      "required_init_params": {
        "id": { "type": "str" },
        "capacity": { "type": "int" }
      },
      "optional_init_params": {}
    },
    {
      "id": "user::TransportJob",
      "required_init_params": {
        "job_id": { "type": "str" },
        "pickup": { "type": "str" },
        "dropoff": { "type": "str" }
      },
      "optional_init_params": {
        "priority": { "type": "int" }
      }
    }
  ],
  "actions": [
    {
      "id": "user::navigate_to",
      "required_actors": ["user::AGV"]
    },
    {
      "id": "user::pickup",
      "required_actors": ["user::AGV"]
    },
    {
      "id": "user::dropoff",
      "required_actors": ["user::AGV"]
    },
    {
      "id": "user::check_battery",
      "required_actors": ["user::AGV"]
    },
    {
      "id": "user::charge",
      "required_actors": ["user::AGV"]
    }
  ],
  "places": [
    {
      "id": "job_entry",
      "type": "entrypoint",
      "params": {
        "new_actors": ["user::TransportJob"]
      }
    },
    {
      "id": "available_agvs",
      "type": "resource_pool",
      "params": {
        "resource_id": "user::AGV",
        "initial_availability": 10
      }
    },
    {
      "id": "wait_for_agv",
      "type": "wait_with_timeout",
      "params": {
        "timeout_min": 5,
        "on_timeout": "error::no_agv_available"
      }
    },
    {
      "id": "intersection_alpha",
      "type": "resource_pool",
      "params": {
        "resource_id": "user::Zone",
        "initial_availability": 1
      }
    },
    {
      "id": "intersection_beta",
      "type": "resource_pool",
      "params": {
        "resource_id": "user::Zone",
        "initial_availability": 1
      }
    },
    {
      "id": "corridor_north",
      "type": "resource_pool",
      "params": {
        "resource_id": "user::Zone",
        "initial_availability": 3
      }
    },
    {
      "id": "corridor_south",
      "type": "resource_pool",
      "params": {
        "resource_id": "user::Zone",
        "initial_availability": 3
      }
    },
    {
      "id": "navigate_to_pickup",
      "type": "action",
      "params": {
        "action_id": "user::navigate_to",
        "retries": 2,
        "timeout_per_try_min": 5,
        "failure_as_error": true,
        "error_to_global_handler": true
      }
    },
    {
      "id": "execute_pickup",
      "type": "action",
      "params": {
        "action_id": "user::pickup",
        "retries": 2,
        "timeout_per_try_min": 3,
        "failure_as_error": true,
        "error_to_global_handler": true
      }
    },
    {
      "id": "navigate_to_dropoff",
      "type": "action",
      "params": {
        "action_id": "user::navigate_to",
        "retries": 2,
        "timeout_per_try_min": 5,
        "failure_as_error": true,
        "error_to_global_handler": true
      }
    },
    {
      "id": "execute_dropoff",
      "type": "action",
      "params": {
        "action_id": "user::dropoff",
        "retries": 2,
        "timeout_per_try_min": 3,
        "failure_as_error": true,
        "error_to_global_handler": true
      }
    },
    {
      "id": "check_agv_battery",
      "type": "action",
      "params": {
        "action_id": "user::check_battery",
        "retries": 0,
        "timeout_per_try_s": 5,
        "failure_as_error": false,
        "error_to_global_handler": true
      }
    },
    {
      "id": "charging_stations",
      "type": "resource_pool",
      "params": {
        "resource_id": "user::Zone",
        "initial_availability": 2
      }
    },
    {
      "id": "charge_agv",
      "type": "action",
      "params": {
        "action_id": "user::charge",
        "retries": 1,
        "timeout_per_try_min": 30,
        "failure_as_error": true,
        "error_to_global_handler": true
      }
    },
    {
      "id": "log_job_completion",
      "type": "exit_logger",
      "params": {}
    }
  ],
  "transitions": [
    {
      "from": ["job_entry"],
      "to": ["wait_for_agv"]
    },
    {
      "from": ["wait_for_agv", "available_agvs"],
      "to": ["navigate_to_pickup"]
    },
    {
      "from": ["navigate_to_pickup::success", "corridor_north"],
      "to": ["execute_pickup"],
      "priority": 2
    },
    {
      "from": ["navigate_to_pickup::success", "corridor_south"],
      "to": ["execute_pickup"],
      "priority": 1
    },
    {
      "from": ["execute_pickup::success"],
      "to": [
        "navigate_to_dropoff",
        { "to": "corridor_north", "token_filter": "user::Zone" }
      ]
    },
    {
      "from": ["navigate_to_dropoff::success", "intersection_alpha"],
      "to": ["execute_dropoff"]
    },
    {
      "from": ["execute_dropoff::success"],
      "to": [
        "log_job_completion",
        { "to": "check_agv_battery", "token_filter": "user::AGV" },
        { "to": "intersection_alpha", "token_filter": "user::Zone" }
      ]
    },
    {
      "from": ["check_agv_battery::success"],
      "to": ["available_agvs"]
    },
    {
      "from": ["check_agv_battery::failure", "charging_stations"],
      "to": ["charge_agv"]
    },
    {
      "from": ["charge_agv::success"],
      "to": [
        { "to": "available_agvs", "token_filter": "user::AGV" },
        { "to": "charging_stations", "token_filter": "user::Zone" }
      ]
    }
  ],
  "_gui_metadata": {
    "places": {
      "job_entry": { "position": { "x": 100, "y": 300 } },
      "wait_for_agv": { "position": { "x": 300, "y": 300 } },
      "available_agvs": { "position": { "x": 300, "y": 100 } },
      "intersection_alpha": { "position": { "x": 900, "y": 100 } },
      "intersection_beta": { "position": { "x": 900, "y": 500 } },
      "corridor_north": { "position": { "x": 600, "y": 100 } },
      "corridor_south": { "position": { "x": 600, "y": 500 } },
      "navigate_to_pickup": { "position": { "x": 500, "y": 300 } },
      "execute_pickup": { "position": { "x": 700, "y": 300 } },
      "navigate_to_dropoff": { "position": { "x": 900, "y": 300 } },
      "execute_dropoff": { "position": { "x": 1100, "y": 300 } },
      "check_agv_battery": { "position": { "x": 1100, "y": 500 } },
      "charging_stations": { "position": { "x": 700, "y": 600 } },
      "charge_agv": { "position": { "x": 700, "y": 500 } },
      "log_job_completion": { "position": { "x": 1300, "y": 300 } }
    },
    "transitions": {
      "transition_1": { "position": { "x": 200, "y": 300 } },
      "transition_2": { "position": { "x": 400, "y": 200 } },
      "transition_3": { "position": { "x": 600, "y": 200 } },
      "transition_4": { "position": { "x": 600, "y": 400 } },
      "transition_5": { "position": { "x": 800, "y": 300 } },
      "transition_6": { "position": { "x": 1000, "y": 200 } },
      "transition_7": { "position": { "x": 1200, "y": 300 } },
      "transition_8": { "position": { "x": 1200, "y": 400 } },
      "transition_9": { "position": { "x": 900, "y": 550 } },
      "transition_10": { "position": { "x": 500, "y": 500 } }
    }
  }
}
